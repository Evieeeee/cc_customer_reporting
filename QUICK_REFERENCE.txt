# QUICK REFERENCE - Firestore & Historical Data

## ğŸš€ Quick Deploy

```bash
# 1. Make script executable
chmod +x setup-firestore.sh

# 2. Run setup script (does everything!)
./setup-firestore.sh

# That's it! Script handles:
# - Enabling Firestore API
# - Creating database
# - Granting permissions
# - Deploying to Cloud Run
```

---

## ğŸ“Š Using Historical Data

### Collect Current Month Only (Fast - 30-60 seconds)

```
1. Select customer
2. Click Refresh button
3. Wait 30-60 seconds
4. See current month's data
```

### Collect 12 Months of History (Comprehensive - 5-10 minutes)

```
1. Select customer
2. â˜‘ Check "12-month history" checkbox
3. Click Refresh button
4. Wait 5-10 minutes (go get coffee â˜•)
5. See 12 months of trend data in graphs
```

### Monthly Updates (Recommended)

```
Every month:
1. â˜ Uncheck "12-month history" 
2. Click Refresh
3. Wait 30-60 seconds
4. New month added to rolling 12-month window
```

---

## ğŸ“ˆ Reading the Graphs

### What You'll See

```
Graph shows 12 months:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Your Performance (green line)     â”‚
â”‚ Industry Benchmark (gold dashed)  â”‚
â”‚                                    â”‚
â”‚     â•±                              â”‚
â”‚    â•±  â•±â•²                           â”‚
â”‚   â•±  â•±  â•²    â•±â•²                    â”‚
â”‚  â•±  â•±    â•²  â•±  â•²                   â”‚
â”‚ â•±  â•±      â•²â•±    â•²                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 Feb Mar Apr May Jun Jul Aug Sep ...
 2024                          2025
```

### How to Use

- **Click any KPI card** â†’ Shows 12-month graph for that metric
- **Hover over points** â†’ See exact values and dates
- **Look for trends** â†’ Going up? Down? Seasonal patterns?
- **Compare to benchmark** â†’ Green line above gold = exceeding expectations!

---

## ğŸ—‚ï¸ Where Data is Stored

### Firestore Collections

```
customers/                  â† All your customers
  abc123/                   â† Customer ID
    name: "Smile Dental"
    industry: "dental"

credentials/                â† API keys & tokens
  abc123/
    social_media/
      system_user_token: "..."
    email/
      instantly_api_key: "..."

historical_metrics/         â† The good stuff!
  abc123/
    social_media/           â† Medium
      awareness/            â† Journey stage
        2024/               â† Year
          1/                â† January
            kpis/
              Reach/        â† Metric
                kpi_value: 5000
                benchmark: 1000
          2/                â† February
          ...
          12/               â† December
        2025/
          1/
```

---

## ğŸ’° Cost Breakdown

### Firestore
- **Storage:** 100 customers Ã— 1MB each = 100MB = $0.02/month
- **Operations:** 100 customers Ã— 1000 writes/month = $0.20/month
- **Total:** ~$0.25/month

### Cloud Run
- **Compute:** Within free tier (180,000 vCPU-seconds/month)
- **Memory:** Within free tier (360,000 GiB-seconds/month)
- **Total:** $0/month (or ~$1-2 if exceeding free tier)

### Grand Total
**$1-5/month for 100 customers** â† VERY affordable!

---

## ğŸ”§ Common Tasks

### View Data in Firestore Console

```bash
# Open Firestore console
gcloud firestore databases describe

# Or go to:
# https://console.cloud.google.com/firestore
```

### Check Deployment Status

```bash
# View recent logs
gcloud run logs read contentclicks-dashboard --limit 50

# Check service details
gcloud run services describe contentclicks-dashboard \
  --region us-central1
```

### Manually Trigger Historical Collection

```bash
# SSH into Cloud Run or run locally
python data_collector.py --customer-id abc123xyz --history
```

### Export Data

```bash
# Firestore export (backup)
gcloud firestore export gs://YOUR-BUCKET/backups

# Dashboard PDF export
# Click "Export PDF" button in dashboard
```

---

## ğŸ› Troubleshooting

### "Permission denied"

**Problem:** Service account doesn't have Firestore access

**Fix:**
```bash
# Get project number
PROJECT_NUM=$(gcloud projects describe YOUR_PROJECT_ID --format="value(projectNumber)")

# Grant permission
gcloud projects add-iam-policy-binding YOUR_PROJECT_ID \
  --member="serviceAccount:${PROJECT_NUM}-compute@developer.gserviceaccount.com" \
  --role="roles/datastore.user"
```

### "Timeout during historical collection"

**Problem:** Cloud Run timeout (default 300 seconds)

**Fix:**
```bash
# Increase timeout to 10 minutes
gcloud run services update contentclicks-dashboard \
  --region us-central1 \
  --timeout 600
```

### "No data showing in graphs"

**Problem:** Collection might still be running

**Fix:**
1. Wait for collection to complete (check loading overlay)
2. Refresh page (F5)
3. Click a KPI card to load graph
4. Check logs for errors

### "Only 1 month showing instead of 12"

**Problem:** Historical collection not run yet

**Fix:**
1. Check the "12-month history" checkbox
2. Click Refresh
3. Wait 5-10 minutes
4. Refresh page
5. Now you should see 12 months!

---

## ğŸ“ Maintenance

### Monthly Tasks

```
1. Collect current month data:
   - Uncheck "12-month history"
   - Click Refresh
   - Takes 30-60 seconds

2. That's it! New month automatically appears in graphs.
```

### Quarterly Tasks

```
1. Review cost in Google Cloud Console
2. Check Firestore storage size
3. Export backups (optional)
```

### Annual Tasks

```
1. Consider extending to 24-month history
2. Review and update industry benchmarks
3. Archive old data if needed (probably not needed)
```

---

## ğŸ“ Quick Commands Cheat Sheet

```bash
# Deploy
./setup-firestore.sh

# View logs
gcloud run logs read contentclicks-dashboard --limit 100

# Get dashboard URL
gcloud run services describe contentclicks-dashboard \
  --region us-central1 \
  --format="value(status.url)"

# Check Firestore size
gcloud firestore databases describe

# Increase timeout
gcloud run services update contentclicks-dashboard \
  --timeout 600 \
  --region us-central1

# Grant Firestore permissions
gcloud projects add-iam-policy-binding YOUR_PROJECT_ID \
  --member="serviceAccount:${PROJECT_NUM}-compute@developer.gserviceaccount.com" \
  --role="roles/datastore.user"
```

---

## âœ… Pre-Flight Checklist

Before deploying:

- [ ] Firestore API enabled
- [ ] Firestore database created (Native mode)
- [ ] Service account has Datastore User role
- [ ] All files updated in project folder
- [ ] requirements.txt has Firestore dependency
- [ ] Cloud Run timeout set to 600 seconds
- [ ] Tested locally (optional)

After deploying:

- [ ] Can access dashboard URL
- [ ] Can create customer
- [ ] Can add credentials
- [ ] Can collect current data (30-60 sec)
- [ ] Can collect historical data (5-10 min)
- [ ] Graphs show 12 months
- [ ] KPI cards clickable
- [ ] PDF export works

---

## ğŸ‰ Success Indicators

You'll know it's working when:

âœ… Customer creation gives string ID (e.g., "abc123xyz")
âœ… Refresh completes in 30-60 seconds
âœ… Historical collection takes 5-10 minutes
âœ… Graphs show line with 12 points
âœ… X-axis labels are "YYYY-MM" format
âœ… Can see trends over time
âœ… Green line moves up/down showing performance
âœ… Gold dashed line shows benchmark

---

## ğŸ“š More Help

- **Full deployment guide:** See FIRESTORE_MIGRATION_GUIDE.txt
- **Changes summary:** See CHANGES_SUMMARY.txt
- **Firestore docs:** https://cloud.google.com/firestore/docs
- **Cloud Run docs:** https://cloud.google.com/run/docs

---

## ğŸš€ Ready to Deploy?

**Run one command:**

```bash
./setup-firestore.sh
```

**That's it!** Script does everything automatically. 

**Your upgraded dashboard will be live in 3-5 minutes!** ğŸŠ
